<p align="center">
  <a href="README.md">English</a> | <a>ä¸­æ–‡</a>
</p>

# Snell Server Docker é•œåƒ
 [![Build](https://github.com/waterdrops/snell-server-docker/actions/workflows/build-push.yml/badge.svg)](https://github.com/waterdrops/snell-server-docker/actions/workflows/build-push.yml) [![Release](https://img.shields.io/github/release/waterdrops/snell-server-docker.svg?style=flat-square&logo=github&logoColor=fff&color=005AA4)](https://github.com/waterdrops/snell-server-docker/releases) [![Image Size](https://img.shields.io/docker/image-size/1byte/snell-server?style=&logo=docker)](https://hub.docker.com/r/1byte/snell-server/) [![Docker Pulls](https://img.shields.io/docker/pulls/1byte/snell-server.svg?style=&logo=docker)](https://hub.docker.com/r/1byte/snell-server) [![Docker Stars](https://img.shields.io/docker/stars/1byte/snell-server.svg?style=flat-square&logo=docker)](https://hub.docker.com/r/1byte/snell-server/) [![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Fwaterdrops%2Fsnell-server.svg?type=small)](https://app.fossa.com/projects/git%2Bgithub.com%2Fwaterdrops%2Fsnell-server?ref=badge_small) [![Repository License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](https://opensource.org/license/mit)

ä¸€ä¸ªè½»é‡çº§çš„ã€æ”¯æŒå¤šæ¶æ„ï¼ˆ`linux/amd64` å’Œ `linux/arm64`ï¼‰çš„ Snell Server Docker é•œåƒã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å®ƒ

æœ¬é¡¹ç›®æä¾›å¼€ç®±å³ç”¨ã€é»˜è®¤å®‰å…¨çš„æœ€å°é•œåƒï¼Œå¯è‡ªåŠ¨ç”Ÿæˆæœ‰æ•ˆé…ç½®ï¼ˆæˆ–å¤ç”¨ç°æœ‰é…ç½®ï¼‰ï¼Œå¹¶åœ¨å¤šæ¶æ„ç¯å¢ƒä¸‹ç»Ÿä¸€ä½“éªŒï¼Œè®©ä½ ä»"å¯ç”¨"åˆ°"ä¸Šçº¿"åªéœ€å‡ ç§’ã€‚


## å¯ç”¨é•œåƒ

æœ¬é¡¹ç›®æä¾›ä¸¤ä¸ªæ¥æºçš„ Docker é•œåƒï¼š

- **Docker Hub**: `1byte/snell-server`
- **GitHub Container Registry (GHCR)**: `ghcr.io/waterdrops/snell-server`

ä¸¤ä¸ªé•œåƒå®Œå…¨ç›¸åŒï¼Œæ‚¨å¯ä»¥æ ¹æ®åå¥½é€‰æ‹©ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚

## ç‰¹æ€§

- **å¤šé˜¶æ®µæ„å»º** ä»¥è·å¾—æ›´å°çš„é•œåƒå¤§å°
- **å¤šæ¶æ„æ”¯æŒ**ï¼š`linux/amd64`ã€`linux/arm64`
- **å¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®**
- **å®‰å…¨é»˜è®¤å€¼**ï¼šéšæœºç«¯å£å’Œéšæœº 32 å­—ç¬¦ PSK
- **æœ€å°ä¾èµ–**ï¼šåŸºäº [frolvlad/alpine-glibc](https://github.com/Docker-Hub-frolvlad/docker-alpine-glibc)ï¼Œæä¾› glibc å…¼å®¹æ€§
- **æ¡ä»¶é…ç½®**ï¼šä»…åœ¨æä¾›å€¼æ—¶å†™å…¥å¯é€‰å­—æ®µ
- **è¾“å…¥éªŒè¯**ï¼šåœ¨å¯åŠ¨å‰éªŒè¯ IPv6 å’Œ OBFS å€¼

## è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœä½ æœ‰æ”¹è¿›å»ºè®®ã€é—®é¢˜æŠ¥å‘Šæˆ–æ–°ç‰¹æ€§æƒ³æ³•ï¼š

- å…ˆå¼€ä¸€ä¸ª Issue è®¨è®ºä½ çš„æè®®
- æäº¤èšç„¦çš„ PR
- å¯ä» "good first issue" ä¸ "help wanted" æ ‡ç­¾çš„é—®é¢˜ç€æ‰‹

æäº¤ä»£ç çš„åŒæ—¶ï¼Œä¹Ÿè¯·åŒæ­¥æ›´æ–°ç›¸å…³æ–‡æ¡£ä¸ç¤ºä¾‹ã€‚

## æ”¯æŒä¸å“åº”

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿å¼€ Issueã€‚æˆ‘ä¼šå°½é‡ä¿æŒå“åº”ï¼Œå°¤å…¶æ¬¢è¿é¦–æ¬¡è´¡çŒ®è€…ã€‚å³ä½¿åªæ˜¯åé¦ˆå’Œå»ºè®®ï¼Œä¹Ÿéå¸¸æœ‰ä»·å€¼ã€‚

## ç¯å¢ƒå˜é‡

| å˜é‡        | é»˜è®¤å€¼                     | æè¿°          | éªŒè¯è§„åˆ™                      |
| ----------- | --------------------------- | ------------- | ----------------------------- |
| `PORT`      | éšæœº 1025â€“65535            | ç›‘å¬ç«¯å£      | å¿…é¡»æ˜¯ 1025â€“65535 ä¹‹é—´çš„æ•´æ•°  |
| `PSK`       | éšæœº 32 å­—ç¬¦å­—æ¯æ•°å­—        | é¢„å…±äº«å¯†é’¥    | å¿…éœ€                          |
| `IPv6`      | æœªè®¾ç½®ï¼ˆå¯é€‰ï¼‰              | å¯ç”¨ IPv6     | å¦‚æœæä¾›ï¼Œå¿…é¡»æ˜¯ `true` æˆ– `false` |
| `OBFS`      | æœªè®¾ç½®ï¼ˆå¯é€‰ï¼‰              | æ··æ·†æ¨¡å¼      | å¦‚æœæä¾›ï¼Œå¿…é¡»æ˜¯ `off` æˆ– `http` |
| `OBFS_HOST` | æœªè®¾ç½®ï¼ˆå¯é€‰ï¼‰              | æ··æ·†ä¸»æœº      | ä»…åœ¨ `OBFS=http` æ—¶ä½¿ç”¨       |
| `TFO`       | `true`                      | å¯ç”¨ TCP Fast Open | å¸ƒå°”å€¼                    |

## é…ç½®è¡Œä¸º

æœåŠ¡å™¨ä½¿ç”¨æ¡ä»¶é…ç½®å†™å…¥ï¼š

- **IPv6**ï¼šä»…åœ¨è®¾ç½® `IPv6` ç¯å¢ƒå˜é‡æ—¶å†™å…¥é…ç½®
- **OBFS**ï¼šä»…åœ¨è®¾ç½® `OBFS` ç¯å¢ƒå˜é‡æ—¶å†™å…¥é…ç½®
- **OBFS_HOST**ï¼šä»…åœ¨ `OBFS=http` ä¸”è®¾ç½® `OBFS_HOST` æ—¶å†™å…¥é…ç½®
- **å·²æœ‰é…ç½®æ–‡ä»¶**ï¼šå¦‚æœå·²ç»å­˜åœ¨ `snell-server.conf`ï¼ˆä¾‹å¦‚é€šè¿‡ volume æŒ‚è½½ï¼‰ï¼Œè„šæœ¬å°†ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶å¹¶è·³è¿‡ç”Ÿæˆ

## Docker é•œåƒ

```bash
# Docker Hub
docker pull 1byte/snell-server

# GitHub Container Registry
docker pull ghcr.io/waterdrops/snell-server
```

## æ„å»ºé•œåƒ

### æœ¬åœ°æ„å»ºï¼š

```bash
# ä½¿ç”¨é»˜è®¤ Snell ç‰ˆæœ¬æ„å»ºï¼ˆ5.0.1ï¼‰
git clone https://github.com/waterdrops/snell-server-docker.git
cd snell-server-docker
docker build -t 1byte/snell-server .

# ä½¿ç”¨æŒ‡å®š Snell ç‰ˆæœ¬æ„å»º
docker build --build-arg SNELL_VERSION=4.1.1 -t 1byte/snell-server:4.1.1 .
```

### å¤šæ¶æ„æ„å»ºï¼ˆéœ€è¦ buildxï¼‰ï¼š

```bash
# ä½¿ç”¨é»˜è®¤ Snell ç‰ˆæœ¬æ„å»ºï¼ˆ5.0.1ï¼‰
cd snell-server-docker # è¯·ç¡®ä¿å…ˆå…‹éš†ä»“åº“
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  -t 1byte/snell-server:latest .

# ä½¿ç”¨æŒ‡å®š Snell ç‰ˆæœ¬æ„å»º
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  --build-arg SNELL_VERSION=4.1.1 \
  -t 1byte/snell-server:v4.1.1 .
```

## è¿è¡Œç¤ºä¾‹

### é»˜è®¤é…ç½®ï¼ˆéšæœºç«¯å£å’Œ PSKï¼Œä»…ç”¨äºæµ‹è¯•ï¼‰

```bash
# ä½¿ç”¨ Docker Hub
docker run --rm 1byte/snell-server

# ä½¿ç”¨ GitHub Container Registry
docker run --rm ghcr.io/waterdrops/snell-server
```

### æŒ‡å®šç«¯å£å’Œ PSK

```bash
# ä½¿ç”¨ Docker Hub
docker run -itd -p 8234:8234 \
  -e PORT=8234 \
  -e PSK=mysecurepsk \
  1byte/snell-server

# ä½¿ç”¨ GitHub Container Registry
docker run -itd -p 8234:8234 \
  -e PORT=8234 \
  -e PSK=mysecurepsk \
  ghcr.io/waterdrops/snell-server
```

### å®Œæ•´é…ç½®ç¤ºä¾‹

è¯·å‚è€ƒ `ç¯å¢ƒå˜é‡` éƒ¨åˆ†å¹¶æ ¹æ®éœ€è¦è°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `OBFS=off` æ¥ç¦ç”¨æ··æ·†ã€‚

```bash
# ä½¿ç”¨ Docker Hub
docker run -itd -p 8234:8234 \
  -e PORT=8234 \
  -e PSK=mysecurepsk \
  -e IPv6=true \
  -e OBFS=http \
  -e OBFS_HOST=gateway.icloud.com \
  -e TFO=false \
  1byte/snell-server

# ä½¿ç”¨ GitHub Container Registry
docker run -itd -p 8234:8234 \
  -e PORT=8234 \
  -e PSK=mysecurepsk \
  -e IPv6=true \
  -e OBFS=http \
  -e OBFS_HOST=gateway.icloud.com \
  -e TFO=false \
  ghcr.io/waterdrops/snell-server
```

## ä½¿ç”¨ docker-compose è¿è¡Œ

### å¿«é€Ÿå¼€å§‹

1. ç¡®ä¿ `docker-compose.yml` ä½äºå½“å‰å·¥ä½œç›®å½•
2. é€šè¿‡ `.env` æ–‡ä»¶ï¼ˆæ¨èï¼‰æˆ– Shell æä¾›ç¯å¢ƒå˜é‡

#### ç¤ºä¾‹ `.env` å’Œ docker-compose.ymlï¼ˆä¸ `docker-compose.yml` åŒç›®å½•ï¼‰ï¼š

##### `.env`

```env
PORT=8234
PSK=mysecurepsk
# IPv6=false
# TFO=true
# OBFS=http
# OBFS_HOST=gateway.icloud.com
```

##### `docker-compose.yml`

```yaml
services:
  snell-server:
    container_name: snell-server
    restart: always
    image: 1byte/snell-server:latest
    ports:
      - "${PORT:-8234}:${PORT:-8234}"   # å¦‚æœæœªè®¾ç½® PORTï¼Œé»˜è®¤ä¸º 8234
    environment:
      PORT: "${PORT}"
      PSK: "${PSK}"
      # IPv6: "${IPv6}"
      # TFO: "${TFO}"
      # OBFS: "${OBFS}"        # è®¾ç½®ä¸º "false" ç¦ç”¨ï¼›`http` å¯ç”¨
      # OBFS_HOST: "${OBFS_HOST}"
    # volumes:
    #   - ./snell-server.conf:/app/snell-server.conf
```


##### ä½¿ç”¨è‡ªå®šä¹‰ snell-server.conf

å¦‚æœä½ å·²ç»æœ‰ `snell-server.conf`ï¼Œå¯é€šè¿‡æŒ‚è½½ä½¿ç”¨ï¼Œè„šæœ¬ä¼šè·³è¿‡è‡ªåŠ¨ç”Ÿæˆï¼š

```yaml
services:
  snell-server:
    # ...
    volumes:
      - ./snell-server.conf:/app/snell-server.conf
```

å¯ç”¨è¯¥æŒ‚è½½åï¼Œå®¹å™¨å°†ä½¿ç”¨ä½ æä¾›çš„é…ç½®æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡å°†ä¸å†ç”¨äºç”Ÿæˆé…ç½®ã€‚

##### å¯åŠ¨æœåŠ¡ï¼š

```bash
docker compose up -d
```

### Surge å®¢æˆ·ç«¯è®¾ç½®ï¼ˆiOS & macOSï¼‰

#### å‰ç½®è¦æ±‚

- å‘ ISP ç”³è¯·å…¬ç½‘ IP åœ°å€
- ç«¯å£æ˜ å°„
- å¯é€‰ï¼šåŸŸåå’Œ DNS æä¾›å•†ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ï¼‰ã€‚å¦‚æœä½ çš„ IP æ˜¯åŠ¨æ€çš„ï¼Œå»ºè®®ä½¿ç”¨ ddns-go è¿›è¡Œè‡ªåŠ¨ DNS æ›´æ–°ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ DDNS å·¥å…·ã€‚è¯¦è§ [^3]ã€‚

æŠŠä¸‹é¢å†…å®¹æ·»åŠ åˆ°Surgeé…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶å°†`YOUR_FQDN`ã€`YOUR_PUBLIC_IP`ã€`YOUR_DOMAIN`ã€`${PORT}`ã€`${PSK}`ã€`MyHome` å’Œ `IP-CIDR,192.168.188.0/24` æ›¿æ¢ä¸ºä½ çš„å®é™…å€¼ã€‚

è¦äº†è§£æ›´å¤šå…³äº `Surge ç­–ç•¥ç»„` çš„ä¿¡æ¯ï¼Œè¯·å‚é˜… Surge ç­–ç•¥ç»„æ–‡æ¡£[^1] å’Œ Surge æ‰‹å†Œ[^2]ã€‚æœ‰å…³ Snell çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ Snell çŸ¥è¯†åº“[^4]ã€‚

```vim
[Proxy]
home = snell, YOUR_FQDN or YOUR_PUBLIC_IP, ${PORT}, psk=${PSK}, version=5, reuse=true
# å¦‚æœå¯ç”¨äº†æ··æ·† 
# home = snell, YOUR_PUBLIC_IP or YOUR_FQDN, YOUR_PORT, psk=YOUR_PSK, version=5, obfs=http, obfs-host=YOUR_OBFS_HOST, reuse=true, tfo=true
...
[Proxy Group]
# å®šä¹‰ä¸€ä¸ªåä¸º `ğŸ Home` çš„ `subnet` ç±»å‹ç­–ç•¥ç»„ã€‚
# å¦‚æœå½“å‰ Wi-Fi SSID æ˜¯ `MyHome`ï¼Œåˆ™ç›´è¿ï¼›
# å¦åˆ™åˆ‡æ¢åˆ° `ğŸ Home` ç­–ç•¥ç»„ã€‚
# æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [^1]ã€‚
ğŸ Home = subnet, default = home, SSID:MyHome = DIRECT
...
[Rule]
IP-CIDR,192.168.188.0/24,ğŸ Home,no-resolve
# ä½¿ç”¨ DNSï¼ˆå¦‚ Cloudflare æˆ–å…¶ä»–æä¾›å•†ï¼‰æ—¶ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹ä»¥ä¸‹è¡Œã€‚
OR,((DOMAIN,plex.YOUR_DOMAIN), (DOMAIN,vw.YOUR_DOMAIN), (DOMAIN,gitea.YOUR_DOMAIN), (DOMAIN,myns.YOUR_DOMAIN)),ğŸ Home
...
```

## é”™è¯¯å¤„ç†

æœåŠ¡å™¨åœ¨å¯åŠ¨å‰éªŒè¯æ‰€æœ‰è¾“å…¥å€¼ï¼š

- **æ— æ•ˆçš„ PORT**ï¼šå¿…é¡»æ˜¯ 1025 åˆ° 65535 ä¹‹é—´çš„æ•´æ•°
- **æ— æ•ˆçš„ IPv6**ï¼šå¦‚æœæä¾›ï¼Œå¿…é¡»æ˜¯ `true` æˆ– `false`
- **æ— æ•ˆçš„ OBFS**ï¼šå¦‚æœæä¾›ï¼Œå¿…é¡»æ˜¯ `off` æˆ– `http`

å¦‚æœä»»ä½•éªŒè¯å¤±è´¥ï¼ŒæœåŠ¡å™¨å°†æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯å¹¶ä»¥ä»£ç  1 é€€å‡ºã€‚


[^1]: https://manual.nssurge.com/policy-group/subnet.html
[^2]: https://manual.nssurge.com/book/understanding-surge/cn/
[^3]: https://github.com/jeessy2/ddns-go
[^4]: https://kb.nssurge.com/surge-knowledge-base/release-notes/snell

## è®¸å¯è¯

[LICENSE](LICENSE)

[![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Fwaterdrops%2Fsnell-server.svg?type=large&issueType=license)](https://app.fossa.com/projects/git%2Bgithub.com%2Fwaterdrops%2Fsnell-server?ref=badge_large&issueType=license)
